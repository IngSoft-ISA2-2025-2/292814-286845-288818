name: Frontend Buildname: Frontend Build



on:on:

  push:  push:

    branches: [ main, develop, feature/* ]    branches: [ main, develop, feature/* ]

  pull_request:  pull_request:    - name: Build Application

    branches: [ main, develop ]          - name: Build Summary

  workflow_dispatch:      if: always()

      run: |

env:        echo "## ðŸ¥ï¸ Frontend Build Results" >> $GITHUB_STEP_SUMMARY

  WORKING_DIRECTORY: 'Obligatorio/Material/Codigo/Frontend'        if [ "${{ needs.detect-frontend-changes.outputs.frontend-changed }}" = "true" ]; then

          if [[ "${{ job.status }}" == "success" ]]; then

jobs:            echo "âœ… **Build Status**: Successful" >> $GITHUB_STEP_SUMMARY

  detect-frontend-changes:          else

    name: Detect Frontend Changes            echo "âŒ **Build Status**: Failed" >> $GITHUB_STEP_SUMMARY

    runs-on: ubuntu-latest          fi

    outputs:          echo "- Framework: Angular" >> $GITHUB_STEP_SUMMARY

      frontend-changed: ${{ steps.changes.outputs.frontend }}          echo "- Node.js Version: 18.x" >> $GITHUB_STEP_SUMMARY

    steps:          echo "- Working Directory: ${{ env.WORKING_DIRECTORY }}" >> $GITHUB_STEP_SUMMARY

    - name: Checkout code          echo "- Tests: Unit tests executed with coverage" >> $GITHUB_STEP_SUMMARY

      uses: actions/checkout@v4        else

      with:          echo "â­ï¸ **Build Status**: Skipped (no frontend changes detected)" >> $GITHUB_STEP_SUMMARY

        fetch-depth: 0          echo "- This check passes automatically when no frontend changes are present" >> $GITHUB_STEP_SUMMARY

        fis.detect-frontend-changes.outputs.frontend-changed == 'true'

    - name: Check for frontend changes      working-directory: ${{ env.WORKING_DIRECTORY }}

      id: changes      run: |

      run: |        echo "ðŸ¥ï¸ Building Angular application..."

        echo "ðŸ” Checking for frontend changes..."        npm run build --prod

                echo "âœ… Build completed successfully"branches: [ main, develop ]

        if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then  workflow_dispatch:

          echo "Manual trigger - running frontend build"

          echo "frontend=true" >> $GITHUB_OUTPUTenv:

          exit 0  WORKING_DIRECTORY: 'Obligatorio/Material/Codigo/Frontend'

        fi

        jobs:

        # For pull requests, compare against base branch  detect-frontend-changes:

        if [ "${{ github.event_name }}" = "pull_request" ]; then    name: Detect Frontend Changes

          BASE_SHA="${{ github.event.pull_request.base.sha }}"    runs-on: ubuntu-latest

          HEAD_SHA="${{ github.sha }}"    outputs:

        else      frontend-changed: ${{ steps.changes.outputs.frontend }}

          # For pushes, compare with previous commit    steps:

          BASE_SHA="${{ github.event.before }}"    - name: Checkout code

          HEAD_SHA="${{ github.sha }}"      uses: actions/checkout@v4

        fi      with:

                fetch-depth: 0

        # Check if frontend files changed

        if git diff --name-only "$BASE_SHA" "$HEAD_SHA" | grep -q "Obligatorio/Material/Codigo/Frontend"; then    - name: Check for frontend changes

          echo "âœ… Frontend changes detected"      id: changes

          echo "frontend=true" >> $GITHUB_OUTPUT      run: |

        else        echo "ðŸ” Checking for frontend changes..."

          echo "â­ï¸ No frontend changes detected - build will skip"        

          echo "frontend=false" >> $GITHUB_OUTPUT        if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then

        fi          echo "Manual trigger - running frontend build"

          echo "frontend=true" >> $GITHUB_OUTPUT

  build:          exit 0

    name: Frontend Build        fi

    runs-on: ubuntu-latest        

    needs: detect-frontend-changes        # For pull requests, compare against base branch

    if: always()        if [ "${{ github.event_name }}" = "pull_request" ]; then

              BASE_SHA="${{ github.event.pull_request.base.sha }}"

    steps:          HEAD_SHA="${{ github.sha }}"

    - name: Skip if no frontend changes        else

      if: needs.detect-frontend-changes.outputs.frontend-changed != 'true'          # For pushes, compare with previous commit

      run: |          BASE_SHA="${{ github.event.before }}"

        echo "â­ï¸ Skipping frontend build - no frontend changes detected"          HEAD_SHA="${{ github.sha }}"

        echo "âœ… This check passes automatically when no frontend changes are present"        fi

        exit 0        

                # Check if frontend files changed

    - name: Checkout code        if git diff --name-only "$BASE_SHA" "$HEAD_SHA" | grep -q "Obligatorio/Material/Codigo/Frontend"; then

      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'          echo "âœ… Frontend changes detected"

      uses: actions/checkout@v4          echo "frontend=true" >> $GITHUB_OUTPUT

        else

    - name: Setup Node.js          echo "â­ï¸ No frontend changes detected - build will skip"

      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'          echo "frontend=false" >> $GITHUB_OUTPUT

      uses: actions/setup-node@v4        fi

      with:

        node-version: '18.x'  build:

        cache: 'npm'    name: Frontend Build

        cache-dependency-path: ${{ env.WORKING_DIRECTORY }}/package-lock.json    runs-on: ubuntu-latest

    needs: detect-frontend-changes

    - name: Cache node modules    if: always()

      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'    

      uses: actions/cache@v4    steps:

      with:    - name: Skip if no frontend changes

        path: ${{ env.WORKING_DIRECTORY }}/node_modules      if: needs.detect-frontend-changes.outputs.frontend-changed != 'true'

        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}      run: |

        restore-keys: |        echo "â­ï¸ Skipping frontend build - no frontend changes detected"

          ${{ runner.os }}-node-        echo "âœ… This check passes automatically when no frontend changes are present"

        exit 0

    - name: Install dependencies        

      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'    - name: Checkout code

      working-directory: ${{ env.WORKING_DIRECTORY }}      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'

      run: |      uses: actions/checkout@v4

        echo "ðŸ”„ Installing npm dependencies..."

        npm ci    - name: Setup Node.js

        echo "âœ… Dependencies installed successfully"      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'

      uses: actions/setup-node@v4

    - name: Build Application      with:

      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'        node-version: '18.x'

      working-directory: ${{ env.WORKING_DIRECTORY }}        cache: 'npm'

      run: |        cache-dependency-path: ${{ env.WORKING_DIRECTORY }}/package-lock.json

        echo "ðŸ—ï¸ Building Angular application..."

        npm run build --prod    - name: Cache node modules

        echo "âœ… Build completed successfully"      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'

      uses: actions/cache@v4

    - name: Run Unit Tests      with:

      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'        path: ${{ env.WORKING_DIRECTORY }}/node_modules

      working-directory: ${{ env.WORKING_DIRECTORY }}        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}

      run: |        restore-keys: |

        echo "ðŸ§ª Running unit tests..."          ${{ runner.os }}-node-

        npm run test -- --watch=false --browsers=ChromeHeadless --code-coverage

        echo "âœ… Unit tests completed successfully"    - name: Install dependencies

      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'

    - name: Upload build artifacts      working-directory: ${{ env.WORKING_DIRECTORY }}

      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'      run: |

      uses: actions/upload-artifact@v4        echo "ðŸ”„ Installing npm dependencies..."

      with:        npm ci

        name: frontend-build-artifacts        echo "âœ… Dependencies installed successfully"

        path: |

          ${{ env.WORKING_DIRECTORY }}/dist/    - name: Build Application

        retention-days: 1      working-directory: ${{ env.WORKING_DIRECTORY }}

      run: |

    - name: Upload test coverage        echo "ðŸ—ï¸ Building Angular application..."

      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'        npm run build --prod

      uses: actions/upload-artifact@v4        echo "âœ… Build completed successfully"

      with:

        name: frontend-coverage-report    - name: Run Unit Tests

        path: |      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'

          ${{ env.WORKING_DIRECTORY }}/coverage/      working-directory: ${{ env.WORKING_DIRECTORY }}

        retention-days: 1      run: |

        echo "ðŸ§ª Running unit tests..."

    - name: Build Summary        npm run test -- --watch=false --browsers=ChromeHeadless --code-coverage

      if: always()        echo "âœ… Unit tests completed successfully"

      run: |

        echo "## ðŸ—ï¸ Frontend Build Results" >> $GITHUB_STEP_SUMMARY    - name: Upload build artifacts

        if [ "${{ needs.detect-frontend-changes.outputs.frontend-changed }}" = "true" ]; then      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'

          if [[ "${{ job.status }}" == "success" ]]; then      uses: actions/upload-artifact@v4

            echo "âœ… **Build Status**: Successful" >> $GITHUB_STEP_SUMMARY      with:

          else        name: frontend-build-artifacts

            echo "âŒ **Build Status**: Failed" >> $GITHUB_STEP_SUMMARY        path: |

          fi          ${{ env.WORKING_DIRECTORY }}/dist/

          echo "- Framework: Angular" >> $GITHUB_STEP_SUMMARY        retention-days: 1

          echo "- Node.js Version: 18.x" >> $GITHUB_STEP_SUMMARY

          echo "- Working Directory: ${{ env.WORKING_DIRECTORY }}" >> $GITHUB_STEP_SUMMARY    - name: Upload test coverage

          echo "- Tests: Unit tests executed with coverage" >> $GITHUB_STEP_SUMMARY      if: needs.detect-frontend-changes.outputs.frontend-changed == 'true'

        else      uses: actions/upload-artifact@v4

          echo "â­ï¸ **Build Status**: Skipped (no frontend changes detected)" >> $GITHUB_STEP_SUMMARY      with:

          echo "- This check passes automatically when no frontend changes are present" >> $GITHUB_STEP_SUMMARY        name: frontend-coverage-report

        fi        path: |
          ${{ env.WORKING_DIRECTORY }}/coverage/
        retention-days: 1

    - name: Build Summary
      run: |
        echo "## ðŸ—ï¸ Frontend Build Results" >> $GITHUB_STEP_SUMMARY
        echo "âœ… **Build Status**: Successful" >> $GITHUB_STEP_SUMMARY
        echo "- Framework: Angular 14" >> $GITHUB_STEP_SUMMARY
        echo "- Node.js Version: 18.x" >> $GITHUB_STEP_SUMMARY
        echo "- Working Directory: ${{ env.WORKING_DIRECTORY }}" >> $GITHUB_STEP_SUMMARY
        echo "- Tests: Unit tests executed with coverage" >> $GITHUB_STEP_SUMMARY